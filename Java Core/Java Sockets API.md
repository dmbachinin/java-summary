# Java Sockets API

`Java Sockets API` — это интерфейс программирования, который позволяет приложениям, написанным на языке Java, обмениваться данными по сети.

- [Java Sockets API](#java-sockets-api)
  - [Sockets API базовая информация](#sockets-api-базовая-информация)
    - [Как подключить Java Sockets API?](#как-подключить-java-sockets-api)
  - [Socket](#socket)
    - [Основные методы Socket](#основные-методы-socket)
  - [ServerSocket](#serversocket)
    - [Основные методы ServerSocket](#основные-методы-serversocket)
    - [InetAddress](#inetaddress)
    - [Основные методы InetAddress](#основные-методы-inetaddress)
  - [Пример работы Sockets API](#пример-работы-sockets-api)
    - [Создание сервера](#создание-сервера)
    - [Создание клиента](#создание-клиента)
    - [Как это работает?](#как-это-работает)

## Sockets API базовая информация

`Java Sockets API` — это интерфейс программирования, который позволяет приложениям, написанным на языке Java, обмениваться данными по сети. Сокеты обеспечивают двусторонний канал связи между двумя машинами или процессами, что позволяет передавать данные, например, между клиентом и сервером.

**Java Sockets API используется для создания сетевых приложений, таких как:**

- Чат-приложения.
- Клиент-серверные приложения (например, веб-серверы и веб-клиенты).
- Игры с сетевым взаимодействием.
- Приложения для обмена файлами и данных в реальном времени.

Основное назначение сокетов — обеспечить механизм связи между двумя компьютерами через интернет или локальную сеть, позволяя отправлять и получать данные между ними.

### Как подключить Java Sockets API?

В Java работа с сокетами встроена в стандартную библиотеку. Для этого используются два основных класса:

1. `Socket` — этот класс используется для создания клиентского сокета, который инициирует соединение с сервером.
2. `ServerSocket` — этот класс используется для создания серверного сокета, который ожидает входящих подключений от клиентов.

## Socket

Класс `Socket` в Java используется для создания клиентских сетевых приложений, которые могут устанавливать соединения с сервером, передавать и получать данные по сети. Этот класс является основной абстракцией, представляющей одну сторону двустороннего TCP-соединения между клиентом и сервером.

### Основные методы Socket

```java
    // Создание сокета и подключение к удаленному серверу
    Socket socket = new Socket(String host, int port); // Этот конструктор создает сокет и сразу же подключается к серверу по указанному адресу "example.com" и порту 8080.
    Socket socket = Socket(); // Создает сокет без соединения. Этот конструктор полезен, если вы хотите создать сокет, но установить соединение позже с помощью метода connect()
    Socket socket = Socket(InetAddress address, int port); // Создает сокет и подключается к серверу, используя объект InetAddress и порт.
    Socket socket = Socket(String host, int port, InetAddress localAddr, int localPort); //Создает сокет, подключается к удаленному хосту и порту, при этом также указывает локальный адрес и порт для исходящего соединения.
    Socket socket = Socket(InetAddress address, int port, InetAddress localAddr, int localPort); // Аналогичен предыдущему, но принимает InetAddress вместо строки для удаленного хоста.
    // Если сервер недоступен или соединение не удается установить, будет выброшено исключение IOException.

    // Получение входного потока сокета
    InputStream inputStream = socket.getInputStream(); 
    // Этот метод возвращает InputStream, связанный с сокетом, который используется для чтения данных, поступающих через соединение.

    // Получение выходного потока сокета
    OutputStream outputStream = socket.getOutputStream(); 
    // Этот метод возвращает OutputStream, связанный с сокетом, который используется для отправки данных через соединение.

    // Установка тайм-аута на ожидание данных
    socket.setSoTimeout(5000); 
    // Этот метод устанавливает тайм-аут на 5000 миллисекунд (5 секунд). Если данные не будут получены в течение этого времени, будет выброшено SocketTimeoutException.

    // Включение/отключение алгоритма Nagle
    socket.setTcpNoDelay(true); 
    // Этот метод отключает алгоритм Nagle, который объединяет мелкие пакеты данных для отправки их одним большим пакетом.
    // Если установлено значение true, данные будут отправляться сразу без задержек.

    // Закрытие выходного потока сокета
    socket.shutdownOutput(); 
    // Этот метод закрывает выходной поток сокета. После вызова этого метода нельзя будет отправлять данные через сокет.
    // Однако сокет все еще может получать данные.

    // Закрытие входного потока сокета
    socket.shutdownInput(); 
    // Этот метод закрывает входной поток сокета. После вызова этого метода нельзя будет читать данные из сокета.

    // Закрытие сокета
    socket.close(); 
    // Этот метод закрывает сокет, освобождая все связанные с ним ресурсы. Если сокет был открыт, он будет разорван.
    // После вызова этого метода любые дальнейшие операции чтения или записи приведут к IOException.

    // Проверка состояния сокета
    boolean isConnected = socket.isConnected(); 
    // Этот метод возвращает true, если сокет подключен к удаленному серверу.
    // Если сокет был закрыт или еще не подключен, вернется false.

    boolean isClosed = socket.isClosed(); 
    // Этот метод возвращает true, если сокет был закрыт, и false, если сокет все еще открыт.
```

## ServerSocket

Класс `ServerSocket` в Java используется для создания серверных приложений, которые принимают входящие сетевые соединения от клиентов. Он слушает определенный порт на локальной машине и ожидает подключения клиентов, создавая новый Socket объект для каждого подключения.

**Основные задачи ServerSocket**:

1. Прослушивание порта:
    - `ServerSocket` прослушивает указанный порт на сервере и ожидает входящих соединений от клиентов.
2. Принятие подключений:
    - Когда клиент пытается подключиться к серверу, `ServerSocket` принимает это соединение и создает новый `Socket`, который можно использовать для обмена данными с клиентом.

### Основные методы ServerSocket

```java
    // Создание ServerSocket, который будет слушать определенный порт
    ServerSocket serverSocket = new ServerSocket(8080); 
    // Этот конструктор создает ServerSocket и привязывает его к порту 8080 на локальной машине.
    // Сервер теперь может прослушивать этот порт и ожидать входящих соединений от клиентов.

    // Ожидание подключения клиента
    Socket clientSocket = serverSocket.accept(); 
    // Этот метод блокирует выполнение программы до тех пор, пока клиент не попытается подключиться к серверу.
    // Когда клиент подключается, возвращается новый объект Socket, который представляет собой соединение с этим клиентом.

    // Закрытие ServerSocket
    serverSocket.close(); 
    // Этот метод закрывает ServerSocket, прекращая прослушивание порта.
    // Любые дальнейшие попытки подключения клиентов будут отклонены.

    // Получение локального порта, к которому привязан сервер
    int localPort = serverSocket.getLocalPort(); 
    // Этот метод возвращает номер порта, на котором ServerSocket прослушивает входящие подключения.

    // Установка тайм-аута на ожидание подключения клиента
    serverSocket.setSoTimeout(5000); 
    // Этот метод устанавливает тайм-аут на 5000 миллисекунд (5 секунд) для метода accept().
    // Если за это время клиент не подключится, accept() выбросит SocketTimeoutException.

    // Получение тайм-аута на ожидание подключения клиента
    int timeout = serverSocket.getSoTimeout(); 
    // Этот метод возвращает текущее значение тайм-аута, установленного для метода accept().

    // Разрешение/запрещение повторного использования порта
    serverSocket.setReuseAddress(true); 
    // Этот метод позволяет или запрещает повторное использование порта после закрытия ServerSocket.
    // Это полезно для быстрого перезапуска сервера без ожидания освобождения порта.

    // Проверка, разрешено ли повторное использование порта
    boolean reuseAddress = serverSocket.getReuseAddress(); 
    // Этот метод возвращает true, если разрешено повторное использование порта, иначе false.

    // Получение IP-адреса, к которому привязан ServerSocket
    InetAddress localAddress = serverSocket.getInetAddress(); 
    // Этот метод возвращает объект InetAddress, представляющий локальный адрес, к которому привязан ServerSocket.

    // Получение размера очереди соединений
    int backlogSize = serverSocket.getReceiveBufferSize(); 
    // Этот метод возвращает текущий размер буфера приема (очереди соединений).
    // Это количество клиентских подключений, которые могут быть ожидающими в очереди, пока сервер обрабатывает текущее соединение.

    // Установка размера очереди соединений
    serverSocket.setReceiveBufferSize(8192); 
    // Этот метод устанавливает размер буфера приема (очереди соединений) в 8192 байта.

    // Проверка, закрыт ли ServerSocket
    boolean isClosed = serverSocket.isClosed(); 
    // Этот метод возвращает true, если ServerSocket был закрыт, иначе false.

    // Проверка, привязан ли ServerSocket к локальному адресу
    boolean isBound = serverSocket.isBound(); 
    // Этот метод возвращает true, если ServerSocket привязан к локальному адресу и порту, иначе false.

```

### InetAddress

Класс `InetAddress` в Java представляет собой IP-адрес и доменное имя хоста. Он используется для работы с сетевыми адресами, такими как IP-адреса, и позволяет получать информацию о хостах и IP-адресах в сети.

### Основные методы InetAddress

```java
    // Получение объекта InetAddress для локального хоста
    InetAddress localAddress = InetAddress.getLocalHost(); 
    // Этот метод возвращает объект InetAddress, представляющий локальный хост (т.е. вашу машину).

    // Получение объекта InetAddress по имени хоста
    InetAddress googleAddress = InetAddress.getByName("192.168.1.100"); // Получение InetAddress из IP адреса

    InetAddress googleAddress = InetAddress.getByName("www.google.com"); 
    // Этот метод возвращает объект InetAddress, соответствующий доменному имени "www.google.com".
    // В результате вы получите IP-адрес, связанный с этим доменом.

    // Получение массива объектов InetAddress для домена с несколькими IP-адресами
    InetAddress[] googleAddresses = InetAddress.getAllByName("www.google.com"); 
    // Этот метод возвращает массив объектов InetAddress для домена, который может быть связан с несколькими IP-адресами.

    // Получение IP-адреса в виде строки
    String ipAddress = googleAddress.getHostAddress(); 
    // Этот метод возвращает строковое представление IP-адреса, например "142.250.190.78".

    // Получение доменного имени хоста
    String hostName = googleAddress.getHostName(); 
    // Этот метод возвращает доменное имя хоста, соответствующее данному IP-адресу.

    // Получение канонического имени хоста
    String canonicalHostName = googleAddress.getCanonicalHostName(); 
    // Этот метод возвращает каноническое (полное) доменное имя хоста, которое может отличаться от того, что было введено.

    // Проверка доступности хоста
    boolean isReachable = googleAddress.isReachable(5000); 
    // Этот метод проверяет, доступен ли хост в сети. Тайм-аут для проверки составляет 5000 миллисекунд (5 секунд).
    // Возвращает true, если хост доступен, иначе false.

    // Получение объекта InetAddress по IP-адресу в виде байтового массива
    byte[] ip = {(byte) 142, (byte) 250, (byte) 190, (byte) 78};
    InetAddress addressFromBytes = InetAddress.getByAddress(ip); 
    // Этот метод создает объект InetAddress по заданному IP-адресу, представленному в виде байтового массива.

    // Получение объекта InetAddress по имени хоста и IP-адресу
    InetAddress customAddress = InetAddress.getByAddress("example.com", ip); 
    // Этот метод создает объект InetAddress с заданным именем хоста и IP-адресом, представленным в виде байтового массива.
```

## Пример работы Sockets API

Чтобы лучше понять, как работают сокеты, рассмотрим базовый пример создания простого клиент-серверного приложения.

### Создание сервера

Данный код создает сервер, который слушает порт 8080 и ожидает подключения клиента. После подключения сервер может получать сообщения от клиента и отправлять ответы.

```java
import java.io.*;
import java.net.*;

public class SimpleServer {
    public static void main(String[] args) {
        try (ServerSocket serverSocket = new ServerSocket(8080)) {
            System.out.println("Сервер запущен и ожидает подключений...");

            // Ожидаем подключения клиента
            Socket clientSocket = serverSocket.accept();
            System.out.println("Клиент подключился!");

            // Создаем входной и выходной потоки
            PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);
            BufferedReader in = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));

            // Читаем данные от клиента и отправляем ответ
            String clientMessage;
            while ((clientMessage = in.readLine()) != null) {
                System.out.println("Получено от клиента: " + clientMessage);
                out.println("Сервер получил: " + clientMessage);
            }

            // Закрываем соединение
            in.close();
            out.close();
            clientSocket.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### Создание клиента

Данный код создает клиента, который подключается к серверу на локальной машине (localhost) через порт 8080, отправляет сообщение и получает ответ.

```java
import java.io.*;
import java.net.*;

public class SimpleClient {
    public static void main(String[] args) {
        try (Socket socket = new Socket("localhost", 8080)) {
            // Создаем входной и выходной потоки
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));

            // Отправляем сообщение серверу
            out.println("Привет, сервер!");

            // Читаем ответ от сервера
            String serverResponse = in.readLine();
            System.out.println("Ответ сервера: " + serverResponse);

            // Закрываем соединение
            in.close();
            out.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### Как это работает?

1. **Серверная часть:**
   - Сервер создает объект `ServerSocket`, который "слушает" определенный порт (в нашем случае 8080).
   - Когда клиент пытается подключиться, сервер вызывает метод `accept()`, который блокирует выполнение до тех пор, пока не появится клиент. Когда клиент подключается, сервер создает новый объект `Socket`, представляющий соединение с этим клиентом.
   - Сервер может взаимодействовать с клиентом с помощью потоков ввода и вывода.

2. **Клиентская часть:**
    - Клиент создает объект `Socket` и пытается подключиться к серверу, используя его IP-адрес и порт.
    - После установления соединения клиент также может использовать потоки для отправки и получения данных.

**Важные моменты:**

- **Блокирующие операции:** Методы, такие как `accept()`, `readLine()`, блокируют выполнение программы до тех пор, пока не появятся данные или соединение. Это означает, что программа "замораживается", ожидая этих событий.
- **Потоки:** В сетевых приложениях часто используются многопоточные подходы, чтобы позволить серверу одновременно обрабатывать несколько клиентских подключений.
- **Исключения:** Работа с сетью связана с возможными ошибками, такими как недоступность сервера или потеря соединения. Поэтому методы, связанные с сокетами, обычно бросают `IOException`, который нужно обрабатывать.
