# Spring Framework Scheduled

- [Spring Framework Scheduled](#spring-framework-scheduled)
  - [@Scheduled](#scheduled)
    - [Основное назначение](#основное-назначение)
    - [Основны работы @Scheduled](#основны-работы-scheduled)
    - [Параметры аннотации @Scheduled](#параметры-аннотации-scheduled)
    - [Пример использования @Scheduled](#пример-использования-scheduled)
    - [Особенности использования @Scheduled](#особенности-использования-scheduled)

## @Scheduled

Аннотация `@Scheduled` в **Spring Framework** используется для **планирования задач**, которые должны выполняться через определённые интервалы времени или по расписанию. Она является частью механизма **планировщика задач** в Spring и позволяет легко организовывать периодическое выполнение метода.

### Основное назначение

`@Scheduled` позволяет запускать методы с заданной периодичностью, без необходимости вручную управлять потоками или расписаниями. Это очень полезно для выполнения таких задач, как:

- Регулярное обновление данных.
- Очистка или обработка данных.
- Отправка уведомлений.
- Генерация отчётов.

### Основны работы @Scheduled

1. **Механизм планирования**:
   Когда вы добавляете аннотацию `@Scheduled` на метод, Spring автоматически создает задачу, которая будет выполняться в соответствии с указанным расписанием.

2. **Потоки выполнения**:
   Каждая задача, помеченная аннотацией `@Scheduled`, выполняется в отдельном потоке. По умолчанию Spring использует планировщик задач, который обрабатывает выполнение этих задач.

3. **Конфигурация**:
   Для использования аннотации `@Scheduled` необходимо включить поддержку планировщика в вашем приложении, добавив аннотацию `@EnableScheduling` на класс конфигурации.

    ```java
        import org.springframework.context.annotation.Configuration;
        import org.springframework.scheduling.annotation.EnableScheduling;

        @Configuration
        @EnableScheduling
        public class SchedulingConfig {
            // Здесь могут быть дополнительные настройки планировщика
        }
    ```

### Параметры аннотации @Scheduled

1. **`fixedRate`**:
   - Задаёт интервал в миллисекундах между началом выполнения текущей и следующей задачи.
   - Пример: `@Scheduled(fixedRate = 5000)` — задача будет запускаться каждые 5 секунд.

2. **`fixedDelay`**:
   - Устанавливает интервал между завершением текущей задачи и запуском следующей.
   - Пример: `@Scheduled(fixedDelay = 5000)` — следующая задача начнёт выполняться через 5 секунд после завершения предыдущей.

3. **`initialDelay`**:
   - Устанавливает задержку перед первым запуском задачи.
   - Пример: `@Scheduled(initialDelay = 1000, fixedRate = 5000)` — задача начнёт выполняться через 1 секунду, а затем будет запускаться каждые 5 секунд.

4. **`cron`**:
   - Используется для настройки сложного расписания на основе cron-выражения.
   - Пример: `@Scheduled(cron = "0 0/5 * * * ?")` — задача будет выполняться каждые 5 минут.

5. **`zone`** (опционально):
   - Указывает временную зону для выполнения cron-выражений.
   - Пример: `@Scheduled(cron = "0 0 12 * * ?", zone = "Europe/Moscow")` — задача будет выполняться в 12:00 по московскому времени.

### Пример использования @Scheduled

```java
    import org.springframework.scheduling.annotation.Scheduled;
    import org.springframework.stereotype.Component;

    @Component
    public class MyScheduledTask {

        @Scheduled(cron = "0 0/5 * * * ?") // Использование настроек крона
        public void cronTask() {
            System.out.println("Task executed every 5 minutes");
        }

        @Scheduled(initialDelay = 1000, fixedRate = 5000) // Пропуск одной секунды после запуска программы, потом повторение каждые 5 секунд
        public void runAfterDelay() {
            System.out.println("Task executed after initial delay and every 5 seconds after that");
        }

        @Scheduled(cron = "0 0/5 * * * ?")
        public void cronTask() {
            System.out.println("Task executed every 5 minutes");
        }
    }
```

### Особенности использования @Scheduled

- **Многопоточность**: По умолчанию задачи, помеченные `@Scheduled`, выполняются в одном потоке, но если вы хотите параллельное выполнение, можно настроить планировщик задач для использования нескольких потоков.
  
  Например, для Spring Boot, вы можете создать конфигурацию с `TaskScheduler`:

  ```java
  @Configuration
  public class TaskSchedulerConfig {

      @Bean
      public TaskScheduler taskScheduler() {
          return new ConcurrentTaskScheduler(); // или другой TaskScheduler
      }
  }
  ```

- **Инициализация**: Задачи с аннотацией `@Scheduled` начинают выполняться сразу после старта приложения. Они выполняются на основе указанного расписания и продолжаются до тех пор, пока приложение работает.

- **Ошибки и управление задачами**: Если задача завершится с ошибкой, Spring будет пытаться выполнить её снова, если не указаны дополнительные механизмы для обработки ошибок.
