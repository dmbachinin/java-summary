# Spring Boot Actuator

```plantext
    Spring Boot Actuator — это мощный модуль в экосистеме Spring Boot, который предназначен для мониторинга и управления приложениями. Он предоставляет набор готовых к использованию информационных и диагностических конечных точек (endpoints), которые позволяют наблюдать за состоянием приложения, метриками, производительностью, доступными ресурсами, а также управлять приложением в реальном времени.
```

- [Spring Boot Actuator](#spring-boot-actuator)
  - [Для чего нужен Spring Boot Actuator?](#для-чего-нужен-spring-boot-actuator)
  - [Подключение Spring Boot Actuator через Maven](#подключение-spring-boot-actuator-через-maven)
  - [Настройка Actuator в application.properties](#настройка-actuator-в-applicationproperties)
  - [Основные функции Spring Boot Actuator](#основные-функции-spring-boot-actuator)
    - [/health — состояние приложения](#health--состояние-приложения)
    - [/info — информация о приложении](#info--информация-о-приложении)
    - [/metrics — метрики приложения](#metrics--метрики-приложения)
    - [/loggers — управление уровнями логирования](#loggers--управление-уровнями-логирования)
    - [/env — переменные окружения](#env--переменные-окружения)
    - [/shutdown — завершение работы приложения](#shutdown--завершение-работы-приложения)
    - [/mappings — отображение всех доступных запросов](#mappings--отображение-всех-доступных-запросов)
  - [Ограничение доступа к конечным точкам Actuator](#ограничение-доступа-к-конечным-точкам-actuator)
    - [Добавить Spring Security в проект](#добавить-spring-security-в-проект)
    - [Настроить учетные данные пользователя](#настроить-учетные-данные-пользователя)

## Для чего нужен Spring Boot Actuator?

1. **Мониторинг состояния приложения**:
   - Actuator предоставляет важную информацию о состоянии и конфигурации приложения. Это особенно полезно для отслеживания здоровья приложения в продакшн-среде, когда необходимо иметь доступ к информации о текущем состоянии (например, состояние подключений к базам данных, активность потоков, использование памяти).

2. **Метрики и производительность**:
   - Actuator предоставляет различные **метрики производительности**: количество активных потоков, использование памяти, загрузка процессора, частота запросов и их среднее время выполнения. Эти данные можно интегрировать с системами мониторинга (например, Prometheus, Grafana) для отслеживания производительности приложения.

3. **Проверка здоровья приложения (Health Checks)**:
   - Actuator предоставляет конечную точку `/health`, которая отображает состояние различных компонентов приложения (базы данных, очередь сообщений, внешние сервисы). Это критично для балансировщиков нагрузки и систем оркестрации, таких как Kubernetes, для проверки "живости" приложения.

4. **Диагностика и аудит**:
   - Spring Boot Actuator может предоставлять информацию о текущих запросах, автоконфигурации, загруженных бинах, активных профилях и т.д., что облегчает отладку и диагностику приложения.

5. **Управление приложением**:
   - С помощью Actuator можно выполнять операции управления приложением, такие как выключение, перерасчет кэшей, изменение уровня логирования и многое другое.

## Подключение Spring Boot Actuator через Maven

**Maven:**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

## Настройка Actuator в application.properties

По умолчанию Actuator предоставляет ограниченный доступ к конечным точкам. Для того чтобы включить или настроить доступ к ним, нужно внести изменения в файл конфигурации.

**Пример настройки в `application.properties`:**

```properties
management.endpoints.web.exposure.include=health,info,metrics,loggers # Определяет, какие конечные точки будут доступны через HTTP. По умолчанию большинство из них отключены
management.endpoint.health.show-details=always # Показывает подробности состояния для `/health`
```

## Основные функции Spring Boot Actuator

Spring Boot Actuator предоставляет набор предопределенных конечных точек (endpoints), каждая из которых отвечает за конкретную задачу. Вот основные из них:

### /health — состояние приложения

- Отображает информацию о состоянии приложения.
- Состояние может быть **UP** (приложение работает корректно), **DOWN** (приложение неработоспособно) или **UNKNOWN** (недостаточно данных для определения состояния).
- Возможна интеграция с различными внешними компонентами (базы данных, сторонние API) для отображения их состояния.

**Пример запроса:**

``` plantext
GET /actuator/health
```

### /info — информация о приложении

- Показывает информацию о приложении (например, версия, описание, окружение).
- Информация настраивается через файл `application.properties` или `application.yml`.

**Пример запроса:**

``` plantext
GET /actuator/info
```

### /metrics — метрики приложения

- Отображает различные метрики, такие как использование памяти, количество активных потоков, обработанные запросы, время отклика и другие показатели.
- Метрики можно использовать для мониторинга производительности приложения, а также интегрировать их с внешними системами (например, Prometheus).

**Пример запроса:**

``` plantext
GET /actuator/metrics
```

### /loggers — управление уровнями логирования

- Позволяет просматривать и изменять уровни логирования для отдельных классов или пакетов в реальном времени.
- Можно динамически изменять уровень логирования (например, с `INFO` на `DEBUG`) для отладки без необходимости перезагрузки приложения.

**Пример запроса для получения уровня логирования:**

``` plantext
GET /actuator/loggers
```

**Пример изменения уровня логирования:**

``` plantext
POST /actuator/loggers/com.example
Content-Type: application/json
{
  "configuredLevel": "DEBUG"
}
```

### /env — переменные окружения

- Показывает переменные окружения и свойства конфигурации приложения, такие как системные переменные, переменные среды, значения из `application.properties` или `application.yml`.

### /shutdown — завершение работы приложения

- Позволяет корректно завершить работу приложения.
- По умолчанию этот endpoint отключен, так как это может быть потенциально опасно для продакшн-среды.
- Для включения нужно явно задать параметр: `management.endpoint.shutdown.enabled=true`.

**Пример запроса:**

``` plantext
POST /actuator/shutdown
```

### /mappings — отображение всех доступных запросов

- Показывает все доступные URL и контроллеры, доступные в приложении.
- Полезно для отладки маршрутизации и проверок наличия конечных точек.

**Пример запроса:**

``` plantext
GET /actuator/mappings
```

## Ограничение доступа к конечным точкам Actuator

### Добавить Spring Security в проект

```xml
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
```

### Настроить учетные данные пользователя

Для доступа к защищенным конечным точкам через базовую аутентификацию, нужно настроить учетные данные пользователя. Это можно сделать через файл конфигурации application.properties или application.yml, используя стандартные механизмы Spring Security

```properties
    # Пользователь для доступа к защищенным ресурсам
    spring.security.user.name=admin
    spring.security.user.password=admin123
```

После этого при доступе к любым конечным точкам Actuator (например, /actuator/health) будет запрашиваться логин и пароль
